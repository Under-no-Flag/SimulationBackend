

```sql
-- ----------------------------------------------------
-- SQL Script to Create the SimulationPeds Database
-- ----------------------------------------------------

-- 1. 创建数据库
-- 如果数据库已存在，则不会报错并继续执行
CREATE DATABASE IF NOT EXISTS SimulationPeds CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 2. 切换到新创建的数据库上下文
USE SimulationPeds;

-- 3. 创建仿真运行表 (simulation_runs)
-- 用于记录每一次仿真的元数据
CREATE TABLE IF NOT EXISTS simulation_runs (
    run_id INT AUTO_INCREMENT PRIMARY KEY,
    model_name VARCHAR(255) NOT NULL,
    start_date DATETIME NOT NULL,
    end_date DATETIME,
    simulation_parameters TEXT,
    status ENUM('running', 'completed', 'failed') NOT NULL DEFAULT 'running',
    description TEXT
) ENGINE=InnoDB;

-- 4. 创建行人时空数据表 (pedestrian_data)
-- 核心数据表，记录所有行人的时空位置
CREATE TABLE IF NOT EXISTS pedestrian_data (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    run_id INT NOT NULL,
    sim_time DECIMAL(10, 3) NOT NULL,
    model_date DATETIME(3) NULL,
    pedestrian_id INT NOT NULL,
    pos_x DECIMAL(10, 3) NOT NULL,
    pos_y DECIMAL(10, 3) NOT NULL,
    pos_z DECIMAL(10, 3) DEFAULT 0.0,
    speed DECIMAL(8, 3),
    area_name VARCHAR(100),
    FOREIGN KEY (run_id) REFERENCES simulation_runs(run_id) ON DELETE CASCADE
) ENGINE=InnoDB;

-- 5. 为 pedestrian_data 表创建索引
-- 这是保证查询性能的关键！
CREATE INDEX idx_run_time_ped ON pedestrian_data (run_id, sim_time, pedestrian_id);
CREATE INDEX idx_run_area ON pedestrian_data (run_id, area_name);

-- 6. 创建关键事件日志表 (events_log)
-- 记录仿真中的离散关键事件
CREATE TABLE IF NOT EXISTS events_log (
    event_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    run_id INT NOT NULL,
    sim_time DECIMAL(10, 3) NOT NULL,
    pedestrian_id INT,
    event_type VARCHAR(100) NOT NULL,
    event_details TEXT,
    FOREIGN KEY (run_id) REFERENCES simulation_runs(run_id) ON DELETE CASCADE
) ENGINE=InnoDB;

-- 7. 为 events_log 表创建索引
CREATE INDEX idx_run_event_type ON events_log (run_id, event_type);

-- ----------------------------------------------------
-- 脚本结束
-- ----------------------------------------------------

```