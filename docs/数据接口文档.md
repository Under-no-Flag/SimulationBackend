

# 仿真模型相关接口文档

## 1. 仿真模型接口

### 仿真模型启动


**接口地址**: `GET /api/simulation`


# 数据获取接口文档

## 概述

本文档描述了仿真系统中用于从数据库获取数据的 REST API 接口。所有接口都支持跨域请求，基础路径为 `/api`。

## 通用响应格式

所有接口都返回统一的 JSON 响应格式：

```json
{
  "success": true,
  "message": "操作描述信息",
  "data": "具体数据内容"
}
```

- `success`: 布尔值，表示请求是否成功
- `message`: 字符串，描述操作结果
- `data`: 具体的返回数据，根据接口不同而变化

## 1. 仿真运行记录接口

### 1.1 获取所有仿真运行记录

**接口地址**: `GET /api/simulation/runs`

**描述**: 获取系统中所有的仿真运行记录

**请求参数**: 无

**响应示例**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": [
    {
      "runId": 1,
      "modelName": "人流仿真模型",
      "startDate": "2025-08-03T10:00:00",
      "endDate": "2025-08-03T10:30:00",
      "status": "COMPLETED",
      "parameters": "{\"pedestrianCount\": 100}",
      "result": "仿真完成"
    }
  ]
}
```

**数据字段说明**:
- `runId`: 运行ID（整数）
- `modelName`: 模型名称
- `startDate`: 开始时间（ISO 8601 格式）
- `endDate`: 结束时间（ISO 8601 格式）
- `status`: 运行状态（PENDING/RUNNING/COMPLETED/FAILED/CANCELLED）
- `parameters`: 仿真参数（JSON 字符串）
- `result`: 仿真结果描述

### 1.2 根据ID获取仿真运行记录

**接口地址**: `GET /api/simulation/runs/{runId}`

**描述**: 根据运行ID获取特定的仿真运行记录

**路径参数**:
- `runId`: 运行ID（必需）

**响应示例**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "runId": 1,
    "modelName": "人流仿真模型",
    "startDate": "2025-08-03T10:00:00",
    "endDate": "2025-08-03T10:30:00",
    "status": "COMPLETED",
    "parameters": "{\"pedestrianCount\": 100}",
    "result": "仿真完成"
  }
}
```

**错误响应**:
- 404 Not Found: 指定的运行ID不存在

### 1.3 根据时间范围获取仿真运行记录

**接口地址**: `GET /api/simulation/runs/date-range`

**描述**: 获取指定时间范围内的仿真运行记录

**查询参数**:
- `startDate`: 开始时间（ISO 8601 格式，必需）
- `endDate`: 结束时间（ISO 8601 格式，必需）

**请求示例**:
```
GET /api/simulation/runs/date-range?startDate=2025-08-01T00:00:00&endDate=2025-08-03T23:59:59
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": [
    {
      "runId": 1,
      "modelName": "人流仿真模型",
      "startDate": "2025-08-03T10:00:00",
      "endDate": "2025-08-03T10:30:00",
      "status": "COMPLETED",
      "parameters": "{\"pedestrianCount\": 100}",
      "result": "仿真完成"
    }
  ]
}
```

## 2. 行人数据接口

### 2.1 获取行人数据（分页）

**接口地址**: `GET /api/data/pedestrians/{runId}`

**描述**: 获取指定仿真运行的行人数据，支持分页

**路径参数**:
- `runId`: 运行ID（必需）

**查询参数**:
- `page`: 页码（可选，默认值: 0）
- `size`: 每页大小（可选，默认值: 100）

**请求示例**:
```
GET /api/data/pedestrians/1?page=0&size=50
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "content": [
      {
        "id": 1,
        "runId": 1,
        "pedestrianId": 1,
        "simTime": 10.5,
        "posX": 100.0,
        "posY": 200.0,
        "posZ": 0.0,
        "speed": 1.2,
        "areaName": "入口区域",
        "modelDate": "2025-08-03T10:05:00"
      }
    ],
    "pageable": {
      "sort": {
        "sorted": false,
        "unsorted": true
      },
      "pageNumber": 0,
      "pageSize": 50
    },
    "totalElements": 1000,
    "totalPages": 20,
    "first": true,
    "last": false,
    "numberOfElements": 50
  }
}
```

**数据字段说明**:
- `id`: 记录ID
- `runId`: 关联的运行ID
- `pedestrianId`: 行人ID
- `simTime`: 仿真时间（秒）
- `posX/posY/posZ`: 三维坐标位置
- `speed`: 移动速度（米/秒）
- `areaName`: 所在区域名称
- `modelDate`: 模型时间

### 2.2 获取特定行人的数据

**接口地址**: `GET /api/data/pedestrians/{runId}/{pedestrianId}`

**描述**: 获取指定仿真运行中特定行人的所有数据

**路径参数**:
- `runId`: 运行ID（必需）
- `pedestrianId`: 行人ID（必需）

**响应示例**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": [
    {
      "id": 1,
      "runId": 1,
      "pedestrianId": 1,
      "simTime": 10.5,
      "posX": 100.0,
      "posY": 200.0,
      "posZ": 0.0,
      "speed": 1.2,
      "areaName": "入口区域",
      "modelDate": "2025-08-03T10:05:00"
    }
  ]
}
```

### 2.3 获取指定时间范围内的行人数据

**接口地址**: `GET /api/data/pedestrians/{runId}/time-range`

**描述**: 获取指定时间范围内的行人数据

**路径参数**:
- `runId`: 运行ID（必需）

**查询参数**:
- `startTime`: 开始时间（decimal 格式的仿真时间，必需）
- `endTime`: 结束时间（decimal 格式的仿真时间，必需）

**请求示例**:
```
GET /api/data/pedestrians/1/time-range?startTime=10.0&endTime=20.0
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": [
    {
      "id": 1,
      "runId": 1,
      "pedestrianId": 1,
      "simTime": 15.5,
      "posX": 150.0,
      "posY": 250.0,
      "posZ": 0.0,
      "speed": 1.5,
      "areaName": "通道区域",
      "modelDate": "2025-08-03T10:10:00"
    }
  ]
}
```

### 2.4 获取指定区域的行人数据

**接口地址**: `GET /api/data/pedestrians/{runId}/area/{areaName}`

**描述**: 获取指定区域内的所有行人数据

**路径参数**:
- `runId`: 运行ID（必需）
- `areaName`: 区域名称（必需）

**请求示例**:
```
GET /api/data/pedestrians/1/area/入口区域
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": [
    {
      "id": 1,
      "runId": 1,
      "pedestrianId": 1,
      "simTime": 10.5,
      "posX": 100.0,
      "posY": 200.0,
      "posZ": 0.0,
      "speed": 1.2,
      "areaName": "入口区域",
      "modelDate": "2025-08-03T10:05:00"
    }
  ]
}
```

### 2.5 统计行人数量

**接口地址**: `GET /api/data/pedestrians/{runId}/count`

**描述**: 统计指定仿真运行中的行人数据总数

**路径参数**:
- `runId`: 运行ID（必需）

**响应示例**:
```json
{
  "success": true,
  "message": "统计成功",
  "data": 1500
}
```

## 3. 事件日志接口

### 3.1 获取事件日志

**接口地址**: `GET /api/data/events/{runId}`

**描述**: 获取指定仿真运行的所有事件日志

**路径参数**:
- `runId`: 运行ID（必需）

**响应示例**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": [
    {
      "eventId": 1,
      "runId": 1,
      "simTime": 10.5,
      "pedestrianId": 1,
      "eventType": "进入区域",
      "eventDetails": "行人1进入入口区域"
    }
  ]
}
```

**数据字段说明**:
- `eventId`: 事件ID
- `runId`: 关联的运行ID
- `simTime`: 事件发生的仿真时间
- `pedestrianId`: 相关行人ID（可为空）
- `eventType`: 事件类型
- `eventDetails`: 事件详细描述

### 3.2 根据事件类型获取事件日志

**接口地址**: `GET /api/data/events/{runId}/type/{eventType}`

**描述**: 获取指定类型的事件日志

**路径参数**:
- `runId`: 运行ID（必需）
- `eventType`: 事件类型（必需）

**请求示例**:
```
GET /api/data/events/1/type/进入区域
```

**响应示例**:
```json
{
  "success": true,
  "message": "获取成功",
  "data": [
    {
      "eventId": 1,
      "runId": 1,
      "simTime": 10.5,
      "pedestrianId": 1,
      "eventType": "进入区域",
      "eventDetails": "行人1进入入口区域"
    }
  ]
}
```

### 3.3 获取事件类型统计

**接口地址**: `GET /api/data/events/{runId}/statistics`

**描述**: 获取指定仿真运行中各事件类型的统计信息

**路径参数**:
- `runId`: 运行ID（必需）

**响应示例**:
```json
{
  "success": true,
  "message": "统计成功",
  "data": [
    ["进入区域", 150],
    ["离开区域", 145],
    ["碰撞检测", 5]
  ]
}
```

**数据格式说明**:
- 返回数组，每个元素包含 [事件类型, 数量]

## 4. 错误处理

### 常见错误响应

**400 Bad Request** - 请求参数错误:
```json
{
  "success": false,
  "message": "请求参数错误: 缺少必需参数",
  "data": null
}
```

**404 Not Found** - 资源不存在:
```json
{
  "success": false,
  "message": "未找到指定的资源",
  "data": null
}
```

**500 Internal Server Error** - 服务器内部错误:
```json
{
  "success": false,
  "message": "获取数据失败: 数据库连接异常",
  "data": null
}
```

## 5. 使用示例

### JavaScript 示例

```javascript
// 获取所有仿真运行记录
async function getAllRuns() {
  try {
    const response = await fetch('http://localhost:9527/api/simulation/runs');
    const result = await response.json();

    if (result.success) {
      console.log('仿真运行记录:', result.data);
    } else {
      console.error('获取失败:', result.message);
    }
  } catch (error) {
    console.error('请求失败:', error);
  }
}

// 获取特定行人数据
async function getPedestrianData(runId, pedestrianId) {
  try {
    const response = await fetch(`http://localhost:9527/api/data/pedestrians/${runId}/${pedestrianId}`);
    const result = await response.json();

    if (result.success) {
      console.log('行人数据:', result.data);
    } else {
      console.error('获取失败:', result.message);
    }
  } catch (error) {
    console.error('请求失败:', error);
  }
}
```

### Python 示例

```python
import requests

# 获取事件日志
def get_events(run_id):
    try:
        response = requests.get(f'http://localhost:9527/api/data/events/{run_id}')
        result = response.json()

        if result['success']:
            print('事件日志:', result['data'])
        else:
            print('获取失败:', result['message'])
    except Exception as error:
        print('请求失败:', error)

# 获取行人数量统计
def get_pedestrian_count(run_id):
    try:
        response = requests.get(f'http://localhost:9527/api/data/pedestrians/{run_id}/count')
        result = response.json()

        if result['success']:
            print(f'行人总数: {result["data"]}')
        else:
            print('统计失败:', result['message'])
    except Exception as error:
        print('请求失败:', error)
```

## 6. 注意事项

1. **时间格式**:
   - 日期时间使用 ISO 8601 格式（如: `2025-08-03T10:00:00`）
   - 仿真时间使用 decimal 格式（如: `10.5` 表示 10.5 秒）

2. **分页参数**:
   - `page` 从 0 开始计数
   - `size` 建议不超过 1000，避免单次请求数据量过大

3. **字符编码**:
   - 所有请求和响应都使用 UTF-8 编码
   - 区域名称等中文参数需要进行 URL 编码

4. **性能考虑**:
   - 大数据量查询建议使用分页或时间范围限制
   - 避免频繁请求，可考虑客户端缓存

5. **跨域支持**:
   - 所有接口都已配置 CORS 支持
   - 允许来自任意源的跨域请求
